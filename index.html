<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pig Catcher Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
<style>
body { margin:0; background:#ddd; }
canvas { display:block; margin:0 auto; }
</style>
</head>
<body>

<script>
let pigs, box, scoreText, highText, missText;
let score = 0, misses = 0;
let highScore = localStorage.getItem('pigHighScore') || 0;
const MAX_MISSES = 15;
let spawnTimer;

const config = {
  type: Phaser.CANVAS,
  width: window.innerWidth,
  height: window.innerHeight,
  physics: { default: 'arcade', arcade: { gravity: { y: 100 }, debug: false } },
  scene: { preload, create, update }
};

new Phaser.Game(config);

function preload() {
  this.load.image('bg','assets/IMG_2835.jpeg'); // Desert background
  this.load.image('box','assets/IMG_2837.jpeg'); // Cup/box
  this.load.image('pig','assets/IMG_2836.jpeg'); // Pig
}

function create() {
  const w = this.scale.width;
  const h = this.scale.height;

  // Background
  this.add.image(w/2,h/2,'bg').setDisplaySize(w,h);

  // Start screen
  const title = this.add.text(w/2,h/2 - 80,'PIG CATCHER',{font:'48px Arial',fill:'#000'}).setOrigin(0.5);
  const tapText = this.add.text(w/2,h/2,'Tap to Play',{font:'28px Arial',fill:'#000'}).setOrigin(0.5);

  this.input.once('pointerdown',()=>{
    title.destroy();
    tapText.destroy();
    startGame.call(this);
  });
}

function startGame() {
  const w = this.scale.width;
  const h = this.scale.height;
  score = 0;
  misses = 0;

  // Score display
  scoreText = this.add.text(20,20,'Score: 0',{font:'24px Arial',fill:'#000'});
  highText = this.add.text(20,50,'High: '+highScore,{font:'20px Arial',fill:'#000'});
  missText = this.add.text(20,80,'Misses: 0 / '+MAX_MISSES,{font:'20px Arial',fill:'#aa0000'});

  // Cup / box
  box = this.physics.add.staticImage(w/2,h-140,'box').setScale(1.5).refreshBody();

  // Pigs group
  pigs = this.physics.add.group();

  // Spawn pigs periodically
  spawnTimer = this.time.addEvent({
    delay: 1200,
    loop: true,
    callback: ()=>spawnPig.call(this)
  });

  // Catch detection
  this.physics.add.overlap(pigs, box, catchPig, null, this);
}

function spawnPig() {
  const w = this.scale.width;
  const x = Phaser.Math.Between(box.x - box.displayWidth/2 + 20, box.x + box.displayWidth/2 - 20);
  const pig = pigs.create(x,-50,'pig').setScale(0.1);

  // Drag per pig
  pig.setInteractive();
  pig.on('pointerdown', function(pointer){
    this.body.setAllowGravity(false);
    this.scene.input.setDraggable(this);
  });
  pig.on('drag', function(pointer, dragX, dragY){
    this.x = dragX;
    this.y = dragY;
  });
  pig.on('dragend', function(){
    this.body.setAllowGravity(true);
  });
}

function catchPig(pig, box) {
  if (!pig.active) return;
  pig.destroy();
  score++;
  scoreText.setText('Score: '+score);

  // High score
  if(score > highScore){
    highScore = score;
    localStorage.setItem('pigHighScore',highScore);
    highText.setText('High: '+highScore);

    const text = this.add.text(this.scale.width/2,150,'NEW HIGH SCORE!',{font:'32px Arial',fill:'#ffdd00'}).setOrigin(0.5);
    this.tweens.add({ targets:text, y:100, alpha:0, duration:1200, onComplete:()=>text.destroy() });
  }
}

function update() {
  pigs.getChildren().forEach(pig=>{
    if(pig.y > this.scale.height){
      pig.destroy();
      misses++;
      missText.setText('Misses: '+misses+' / '+MAX_MISSES);
      if(misses >= MAX_MISSES) gameOver.call(this);
    }
  });
}

function gameOver(){
  spawnTimer.remove(false);
  pigs.clear(true,true);
  const w = this.scale.width;
  const h = this.scale.height;
  this.add.rectangle(w/2,h/2,w,h,0x000000,0.6);
  this.add.text(w/2,h/2-40,'GAME OVER',{font:'48px Arial',fill:'#fff'}).setOrigin(0.5);
  this.add.text(w/2,h/2+20,'Tap to Restart',{font:'24px Arial',fill:'#fff'}).setOrigin(0.5)
      .once('pointerdown',()=>location.reload());
}
</script>

</body>
</html>
