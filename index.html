<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ice Lasso</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
<style>
  body { margin:0; background:#aeefff; }
  canvas { display:block; margin:0 auto; }
</style>
</head>
<body>

<div style="text-align:center; margin-top:50%;">
  <h1 style="color:white;">Ice Lasso</h1>
  <p style="color:white;">Tap anywhere to start</p>
</div>

<script>
document.addEventListener('click', function initGame(){

    document.body.innerHTML=''; // remove start text

    const config = {
        type: Phaser.CANVAS,
        width: window.innerWidth*0.95,
        height: window.innerHeight*0.95,
        physics:{ default:'arcade', arcade:{ gravity:{y:120}, debug:false } },
        scale:{ mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
        scene: {
            preload: function(){
                // Load your local assets
                this.load.image('ice','assets/IMG_2832.jpeg');  // Ice cube
                this.load.image('cup','assets/IMG_2833.jpeg');  // Jail-cell cup
            },
            create: function(){
                const w=this.scale.width, h=this.scale.height;

                // Background
                this.cameras.main.setBackgroundColor('#aeefff');

                // Score
                this.score=0;
                this.scoreText=this.add.text(10,10,'Score: 0',{font:'24px Arial',fill:'#000'});

                // Ice group
                this.iceCubes=this.physics.add.group();
                this.time.addEvent({
                    delay:900, // slightly slower spawn
                    loop:true,
                    callback:()=>{
                        const ice=this.iceCubes.create(Phaser.Math.Between(w*0.35,w*0.65), -20, 'ice');
                        ice.setScale(0.3).setBounce(0.3).setCollideWorldBounds(true);
                        ice.melt=100;
                    }
                });

                // Cup (jail-cell)
                const cupX=w/2, cupY=h-150;
                this.cup=this.physics.add.staticImage(cupX, cupY, 'cup');
                this.cup.setScale(0.5).refreshBody();

                // Lasso graphics
                this.lassoLine=this.add.graphics();
                this.grabbed=null;

                // Input
                this.input.on('pointerdown', pointer=>{
                    this.iceCubes.children.iterate(ice=>{
                        if(!ice) return;
                        if(Phaser.Math.Distance.Between(pointer.x,pointer.y,ice.x,ice.y)<40){
                            this.grabbed=ice;
                            ice.body.allowGravity=false;
                        }
                    });
                });
                this.input.on('pointerup', ()=>{
                    if(this.grabbed){ this.grabbed.body.allowGravity=true; this.grabbed=null; }
                });

                // Collider
                this.physics.add.collider(this.iceCubes, this.cup);
            },
            update: function(){
                this.lassoLine.clear();
                if(this.grabbed){
                    const p=this.input.activePointer;
                    this.grabbed.setPosition(p.x,p.y);
                    this.lassoLine.lineStyle(4,0x00ffff,1);
                    this.lassoLine.beginPath();
                    this.lassoLine.moveTo(p.x,p.y);
                    this.lassoLine.lineTo(p.x,p.y-20);
                    this.lassoLine.strokePath();
                }

                // Ice melting & score
                this.iceCubes.children.iterate(ice=>{
                    if(!ice) return;
                    if(Phaser.Geom.Intersects.RectangleToRectangle(ice.getBounds(), this.cup.getBounds())){
                        ice.melt-=0.5;
                        ice.setScale(0.3*(ice.melt/100));
                        ice.setAlpha(ice.melt/100);
                        if(ice.melt<=0){
                            ice.destroy();
                            this.score++;
                            this.scoreText.setText('Score: '+this.score);
                        }
                    }
                });
            }
        }
    };

    new Phaser.Game(config);
    document.removeEventListener('click', initGame);
});
</script>

</body>
</html>
