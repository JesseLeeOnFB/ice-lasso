<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ice Lasso</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
<style>
body { margin:0; background:#9ad7ff; }
canvas { display:block; margin:0 auto; }
</style>
</head>
<body>

<script>
const config = {
  type: Phaser.CANVAS,
  width: window.innerWidth,
  height: window.innerHeight,
  physics: {
    default: 'arcade',
    arcade: { gravity: { y: 300 }, debug: false }
  },
  scene: { preload, create, update }
};

let iceGroup, cup, scoreText, score = 0, grabbed = null, rope;

new Phaser.Game(config);

function preload() {
  this.load.image('ice','https://upload.wikimedia.org/wikipedia/commons/3/3b/Ice_cube.png');
}

function create() {
  const w = this.scale.width;
  const h = this.scale.height;

  this.cameras.main.setBackgroundColor('#9ad7ff');

  scoreText = this.add.text(20,20,'Score: 0',{font:'24px Arial',fill:'#000'});

  // CUP (simple rectangle â€” WORKS)
  cup = this.physics.add.staticImage(w/2, h-100)
    .setDisplaySize(200, 40)
    .refreshBody();

  // Visual cup bars
  const bars = this.add.graphics();
  bars.lineStyle(6, 0x444444);
  bars.strokeRect(w/2 - 100, h-150, 200, 120);

  iceGroup = this.physics.add.group();

  this.time.addEvent({
    delay: 1000,
    loop: true,
    callback: () => {
      const ice = iceGroup.create(
        Phaser.Math.Between(w/2 - 80, w/2 + 80),
        -40,
        'ice'
      );
      ice.setScale(0.3);
    }
  });

  rope = this.add.graphics();

  this.input.on('pointerdown', p => {
    iceGroup.children.iterate(ice => {
      if (!ice) return;
      if (Phaser.Math.Distance.Between(p.x,p.y,ice.x,ice.y) < 40) {
        grabbed = ice;
        ice.body.allowGravity = false;
      }
    });
  });

  this.input.on('pointerup', () => {
    if (grabbed) {
      grabbed.body.allowGravity = true;
      grabbed = null;
    }
  });

  this.physics.add.collider(iceGroup, cup, ice => {
    ice.destroy();
    score++;
    scoreText.setText('Score: ' + score);
  });
}

function update() {
  rope.clear();
  if (grabbed) {
    grabbed.setPosition(this.input.x, this.input.y);
    rope.lineStyle(4, 0x00ffff);
    rope.beginPath();
    rope.moveTo(this.input.x, this.input.y);
    rope.lineTo(this.input.x, this.input.y - 20);
    rope.strokePath();
  }
}
</script>

</body>
</html>
