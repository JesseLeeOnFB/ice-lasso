<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pig Catcher - Desert</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
<style>
body { margin:0; background: #ddd; }
canvas { display:block; margin:0 auto; }
</style>
</head>
<body>

<script>
let gameStarted = false;
let pigs, box, scoreText, highText, missText;
let score = 0, misses = 0;
let highScore = localStorage.getItem('pigHighScore') || 0;
const MAX_MISSES = 15;
let spawnTimer;

const config = {
  type: Phaser.CANVAS,
  width: window.innerWidth,
  height: window.innerHeight,
  physics: { default: 'arcade', arcade: { gravity: { y: 200 }, debug: false } },
  scene: { preload, create, update }
};

new Phaser.Game(config);

function preload() {
  this.load.image('bg', 'https://images.unsplash.com/photo-1597892037957-bf8c9f5b7fc1?auto=format&fit=crop&w=1920&q=80'); // desert
  this.load.image('box', 'https://upload.wikimedia.org/wikipedia/commons/6/6d/Wooden_crate.png'); // box/cup
  this.load.image('pig', 'https://upload.wikimedia.org/wikipedia/commons/3/3a/Pig_icon.png'); // pig
}

function create() {
  const w = this.scale.width;
  const h = this.scale.height;

  // Background
  this.add.image(w/2, h/2, 'bg').setDisplaySize(w, h);

  // Start screen
  const title = this.add.text(w/2, h/2 - 80, 'PIG CATCHER', { font: '48px Arial', fill: '#000' }).setOrigin(0.5);
  const tapText = this.add.text(w/2, h/2, 'Tap to Play', { font: '28px Arial', fill: '#000' }).setOrigin(0.5);

  this.input.once('pointerdown', () => {
    title.destroy();
    tapText.destroy();
    startGame.call(this);
  });
}

function startGame() {
  gameStarted = true;
  score = 0;
  misses = 0;

  const w = this.scale.width;
  const h = this.scale.height;

  scoreText = this.add.text(20, 20, 'Score: 0', { font: '24px Arial', fill: '#000' });
  highText = this.add.text(20, 50, 'High: ' + highScore, { font: '20px Arial', fill: '#000' });
  missText = this.add.text(20, 80, 'Misses: 0 / ' + MAX_MISSES, { font: '20px Arial', fill: '#aa0000' });

  // Box (catch cup)
  box = this.physics.add.staticImage(w/2, h-140, 'box').setScale(1.5).refreshBody();

  // Pigs group
  pigs = this.physics.add.group();

  spawnTimer = this.time.addEvent({
    delay: 900,
    loop: true,
    callback: () => spawnPig.call(this)
  });

  this.physics.add.overlap(pigs, box, catchPig, null, this);
}

function spawnPig() {
  const w = this.scale.width;
  const h = this.scale.height;

  // Spawn within box width Â± half of box width
  const boxWidth = box.displayWidth;
  const x = Phaser.Math.Between(box.x - boxWidth/2 + 20, box.x + boxWidth/2 - 20);

  const pig = pigs.create(x, -50, 'pig').setScale(0.9);
  pig.setVelocityY(0); // gravity will pull it
  pig.body.setCollideWorldBounds(true);
  pig.body.onWorldBounds = true;

  pig.body.world.on('worldbounds', body => {
    if (body.gameObject === pig && pig.active && pig.y >= this.scale.height - 20) {
      pig.destroy();
      misses++;
      missText.setText('Misses: ' + misses + ' / ' + MAX_MIS
