<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ice Lasso</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
<style>
  body { margin:0; background:#5dade2; }
  canvas { display:block; margin:0 auto; }
</style>
</head>
<body>
<div style="text-align:center; margin-top:50%;">
  <h1 style="color:white;">Ice Lasso</h1>
  <p style="color:white;">Tap anywhere to start</p>
</div>

<script>
document.addEventListener('click', function initGame(){

    document.body.innerHTML=''; // remove start text

    const config = {
        type: Phaser.CANVAS, // CANVAS forces better mobile compatibility
        width: window.innerWidth*0.95,
        height: window.innerHeight*0.95,
        physics:{ default:'arcade', arcade:{ gravity:{y:350}, debug:false } },
        scale:{ mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
        scene: {
            preload: function(){
                this.load.image('ice','https://via.placeholder.com/50/00ffff/ffffff?text=Ice');
                this.load.image('cup_bar','https://via.placeholder.com/150x20/964B00/ffffff?text=Bar');
            },
            create: function(){
                const w=this.scale.width, h=this.scale.height;

                this.score=0;
                this.scoreText=this.add.text(10,10,'Score: 0',{font:'24px Arial',fill:'#fff'});

                // Ice group
                this.iceCubes=this.physics.add.group();
                this.time.addEvent({
                    delay:700,
                    loop:true,
                    callback:()=>{
                        const ice=this.iceCubes.create(Phaser.Math.Between(50,w-50), -20, 'ice');
                        ice.setScale(0.5).setBounce(0.5).setCollideWorldBounds(true);
                        ice.melt=100;
                    }
                });

                // Cup
                this.cupBars=[];
                const cupW=w*0.25, cupH=h*0.08;
                const cupX=w/2-cupW/2, cupY=h-cupH-50;
                for(let i=0;i<3;i++){
                    const bar=this.physics.add.staticImage(cupX+cupW/2, cupY+i*(cupH/3),'cup_bar');
                    bar.setScale(cupW/50,0.2).refreshBody().setTint(0xaaaaaa);
                    this.cupBars.push(bar);
                }

                this.lassoLine=this.add.graphics();
                this.grabbed=null;

                this.input.on('pointerdown', pointer=>{
                    this.iceCubes.children.iterate(ice=>{
                        if(!ice) return;
                        if(Phaser.Math.Distance.Between(pointer.x,pointer.y,ice.x,ice.y)<40){
                            this.grabbed=ice;
                            ice.body.allowGravity=false;
                        }
                    });
                });
                this.input.on('pointerup', ()=>{
                    if(this.grabbed){ this.grabbed.body.allowGravity=true; this.grabbed=null; }
                });

                this.cupBars.forEach(bar => this.physics.add.collider(this.iceCubes, bar));
            },
            update: function(){
                this.lassoLine.clear();
                if(this.grabbed){
                    const p=this.input.activePointer;
                    this.grabbed.setPosition(p.x,p.y);
                    this.lassoLine.lineStyle(4,0x00ffff,1);
                    this.lassoLine.beginPath();
                    this.lassoLine.moveTo(p.x,p.y);
                    this.lassoLine.lineTo(p.x,p.y-20);
                    this.lassoLine.strokePath();
                }
                this.iceCubes.children.iterate(ice=>{
                    if(!ice) return;
                    const overCup=this.cupBars.some(bar=>Phaser.Geom.Intersects.RectangleToRectangle(ice.getBounds(), bar.getBounds()));
                    if(overCup){
                        ice.melt-=0.5;
                        ice.setScale(0.5*(ice.melt/100));
                        ice.setAlpha(ice.melt/100);
                        if(ice.melt<=0){
                            ice.destroy();
                            this.score++;
                            this.scoreText.setText('Score: '+this.score);
                        }
                    }
                });
            }
        }
    };

    new Phaser.Game(config);

    document.removeEventListener('click', initGame);
});
</script>

</body>
</html>
