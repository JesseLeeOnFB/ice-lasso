<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ice Lasso</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
<style>
  body { margin:0; background:#aeefff; }
  canvas { display:block; margin:0 auto; }
</style>
</head>
<body>

<div style="text-align:center; margin-top:50%;">
  <h1 style="color:white;">Ice Lasso</h1>
  <p style="color:white;">Tap anywhere to start</p>
</div>

<script>
document.addEventListener('click', function initGame(){

    document.body.innerHTML=''; // remove start text

    const config = {
        type: Phaser.CANVAS,
        width: window.innerWidth*0.95,
        height: window.innerHeight*0.95,
        physics:{ default:'arcade', arcade:{ gravity:{y:120}, debug:false } },
        scale:{ mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
        scene: {
            preload: function(){
                this.load.image('ice','https://www.kindpng.com/picc/m/688-6883664_ice-cube-png-transparent-png.png');
                this.load.image('cup','https://pngtree.com/freepng/transparent-water-glass_6324384.png');
            },
            create: function(){
                const w=this.scale.width, h=this.scale.height;

                this.cameras.main.setBackgroundColor('#aeefff');

                // Score
                this.score=0;
                this.scoreText=this.add.text(10,10,'Score: 0',{font:'24px Arial',fill:'#000'});

                // Ice group
                this.iceCubes=this.physics.add.group();
                this.time.addEvent({
                    delay:900,
                    loop:true,
                    callback:()=>{
                        const ice=this.iceCubes.create(Phaser.Math.Between(w*0.35,w*0.65), -20, 'ice');
                        ice.setScale(0.35).setBounce(0.3).setCollideWorldBounds(true);
                        ice.spawnTime=this.time.now; // store spawn timestamp
                    }
                });

                // Cup visual
                const cupX=w/2, cupY=h-120;
                this.cupImg=this.add.image(cupX,cupY,'cup').setScale(0.5);

                // Invisible bottom collider for instant score
                this.cupCollider=this.physics.add.staticGroup();
                this.cupCollider.create(cupX, cupY+this.cupImg.displayHeight/2 - 10, null)
                    .setDisplaySize(this.cupImg.displayWidth*0.8, 20)
                    .refreshBody();

                // Lasso
                this.lassoLine=this.add.graphics();
                this.grabbed=null;

                // Input
                this.input.on('pointerdown', pointer=>{
                    this.iceCubes.children.iterate(ice=>{
                        if(!ice) return;
                        if(Phaser.Math.Distance.Between(pointer.x,pointer.y,ice.x,ice.y)<50){
                            this.grabbed=ice;
                            ice.body.allowGravity=false;
                        }
                    });
                });
                this.input.on('pointerup', ()=>{
                    if(this.grabbed){ this.grabbed.body.allowGravity=true; this.grabbed=null; }
                });

                // Collider with cup for scoring
                this.physics.add.collider(this.iceCubes, this.cupCollider, (ice)=>{
                    if(!ice.active) return;

                    // Fast catch bonus: 2 seconds threshold
                    const elapsed=(this.time.now - ice.spawnTime)/1000;
                    let points= elapsed <= 2 ? 2 : 1;
                    ice.destroy();
                    this.score+=points;
                    this.scoreText.setText('Score: '+this.score);
                });
            },
            update: function(){
                this.lassoLine.clear();
                if(this.grabbed){
                    const p=this.input.activePointer;
                    this.grabbed.setPosition(p.x,p.y);
                    this.lassoLine.lineStyle(4,0x00ffff,1);
                    this.lassoLine.beginPath();
                    this.lassoLine.moveTo(p.x,p.y);
                    this.lassoLine.lineTo(p.x,p.y-20);
                    this.lassoLine.strokePath();
                }
            }
        }
    };

    new Phaser.Game(config);
    document.removeEventListener('click', initGame);
});
</script>

</body>
</html>
